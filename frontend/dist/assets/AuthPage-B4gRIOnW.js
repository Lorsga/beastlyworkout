import{u as j,a as b,r as u,c as N,j as e,N as m,i as p,l as g,b as A,d as v,g as y}from"./index-CNYxnOg5.js";import{t as h}from"./firestore-CSdz_xXz.js";const n="bw_login_intent";function w(){const{user:r,role:i}=j(),c=b(),[l,a]=u.useState(!1),[d,s]=u.useState("");if(u.useEffect(()=>{N()},[]),r&&i)return sessionStorage.removeItem(n),e.jsx(m,{to:i==="client"?"/app/client":"/app/coach",replace:!0});if(r&&!i){const t=sessionStorage.getItem(n),o=p(r.email);return t==="coach"&&o?e.jsx(m,{to:"/missing-role",replace:!0}):e.jsx(m,{to:"/app/client",replace:!0})}async function f(){a(!0),s("");try{if(sessionStorage.setItem(n,"client"),(await g()).redirected){s("Apertura accesso Google...");return}c("/app/client",{replace:!0})}catch(t){s(h(t))}finally{a(!1)}}async function x(){a(!0),s("");try{sessionStorage.setItem(n,"coach");const t=await g();if(t.redirected){s("Apertura accesso Google...");return}if(!t.user){s("Accesso non completato. Riprova.");return}if(!p(t.user.email)){await A(),s("Questo account non Ã¨ abilitato come PT/Admin. Usa accesso utente.");return}await v();const o=await y(t.user);if(o==="admin"||o==="trainer"){c("/app/coach",{replace:!0});return}c("/missing-role",{replace:!0})}catch(t){s(h(t))}finally{a(!1)}}return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accedi con Google"}),e.jsx("p",{className:"hero-sub",children:"Inizia subito: entra come utente e completa il tuo percorso iniziale."}),e.jsx("button",{className:"btn",disabled:l,onClick:()=>void f(),type:"button",children:l?"Connessione...":"Continua con Google"}),e.jsx("div",{className:"divider"}),e.jsx("h2",{children:"Sei PT/Admin?"}),e.jsx("p",{className:"hint",children:"Usa il tuo account autorizzato per entrare nell'area coach."}),e.jsx("button",{className:"btn btn-ghost",disabled:l,onClick:()=>void x(),type:"button",children:"Continua con Google (PT/Admin)"}),d?e.jsx("p",{className:"message",children:d}):null]})})}export{w as AuthPage};
