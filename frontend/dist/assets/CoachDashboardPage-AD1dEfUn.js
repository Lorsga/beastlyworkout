import{u as B,b as H,r as n,j as e,q as J,s as K,i as V,t as X,v as Y,w as Z}from"./index-BTfkp4DY.js";import{A as O}from"./AppShell-DSbcL5kR.js";import{t as E}from"./firestore-DB3C5Wwr.js";function te(){var k,L;const{role:m,user:d}=B(),{showError:h,showSuccess:I}=H(),[f,M]=n.useState([]),[v,A]=n.useState([]),[j,b]=n.useState(!1),[l,N]=n.useState(null),[T,C]=n.useState(!1),[c,P]=n.useState(""),[p,S]=n.useState(""),[z,g]=n.useState([{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}]),[y,D]=n.useState(""),[R,q]=n.useState("client"),r=v.find(a=>a.clientId===c);n.useEffect(()=>{async function a(){if(!c){N(null);return}try{const s=await J(c,"onboarding");N(s.data()??null)}catch{N(null)}}a()},[c]),n.useEffect(()=>{if(!c)return;if(!r){S(""),g([{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}]);return}S(r.title??"");const a=(r.exercises??[]).map(s=>({name:s.name??"",sets:Number(s.sets??3),reps:s.reps??"10",weight:s.weight??"",mediaUrl:s.mediaUrl??""})).filter(s=>s.name.trim().length>0);g(a.length>0?a:[{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}])},[c,r==null?void 0:r.id]);async function w(){var a;if(m){b(!0);try{const o=(await K()).docs.map(i=>({id:i.id,...i.data()})).filter(i=>i.id!==(d==null?void 0:d.uid)).sort((i,u)=>{const _=(i.displayName||i.email||i.id).toLowerCase(),$=(u.displayName||u.email||u.id).toLowerCase();return _.localeCompare($)});M(o),!c&&((a=o[0])!=null&&a.id)&&P(o[0].id);try{const i=await V(m);A(i.docs.map(u=>({id:u.id,...u.data()})))}catch(i){A([]),h(E(i))}}catch(s){h(E(s))}finally{b(!1)}}}n.useEffect(()=>{w()},[m,d==null?void 0:d.uid]);async function U(a,s){b(!0);try{await a(),I(s),await w()}catch(t){h(E(t))}finally{b(!1)}}function G(){g(a=>[...a,{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}])}function Q(a){g(s=>s.length<=1?s:s.filter((t,o)=>o!==a))}function x(a,s){g(t=>t.map((o,i)=>i===a?{...o,...s}:o))}async function F(){const a=z.map(s=>({name:s.name.trim(),sets:Number(s.sets)||0,reps:s.reps.trim(),weight:s.weight.trim(),mediaUrl:s.mediaUrl.trim()})).filter(s=>s.name.length>0);if(a.length===0){h("Aggiungi almeno un esercizio con nome.");return}r?await U(()=>X(r.id,{title:p,status:"active",exercises:a}),"Scheda aggiornata con successo."):await U(()=>Y({clientId:c,title:p,status:"active",exercises:a}),"Scheda creata e subito visibile al cliente."),C(!1)}function W(){if(!c){h("Seleziona prima un cliente.");return}if(!p.trim()){h("Inserisci un titolo per la scheda.");return}C(!0)}return e.jsxs(O,{role:m==="trainer"?"trainer":"admin",subtitle:"Gestisci clienti, programmi e appuntamenti da un unico posto.",title:"Area Coach",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Crea scheda cliente"}),e.jsxs("label",{children:["Clienti registrati",e.jsxs("select",{value:c,onChange:a=>P(a.target.value),children:[f.length===0?e.jsx("option",{value:"",children:"Nessun cliente disponibile"}):null,f.map(a=>{var s;return e.jsx("option",{value:a.id,children:((s=a.displayName)==null?void 0:s.trim())||a.email||a.id},a.id)})]})]}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>void w(),children:"Aggiorna lista clienti"}),e.jsxs("label",{children:["Titolo programma",e.jsx("input",{value:p,onChange:a=>S(a.target.value),placeholder:"Forza 4 settimane"})]}),e.jsx("p",{className:"hint",children:r?"Questo cliente ha già una scheda: puoi modificarla.":"Questo cliente non ha ancora una scheda: ne creerai una nuova."}),e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px dashed rgba(18,18,18,0.16)"},children:[e.jsx("h2",{children:"Informazioni del cliente"}),e.jsxs("p",{className:"hint",children:["Obiettivo: ",((k=l==null?void 0:l.goal)==null?void 0:k.trim())||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Livello: ",(l==null?void 0:l.experienceLevel)||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Allenamenti a settimana: ",(l==null?void 0:l.trainingDaysPerWeek)??"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Note: ",((L=l==null?void 0:l.notes)==null?void 0:L.trim())||"Nessuna nota inserita"]})]}),e.jsx("button",{className:"btn",disabled:!c||!p||j,onClick:W,type:"button",children:r?"Modifica scheda":"Crea scheda"})]}),T?e.jsx("section",{className:"modal-overlay",role:"dialog","aria-modal":"true",children:e.jsxs("article",{className:"card modal-card",children:[e.jsx("h2",{children:r?"Modifica scheda":"Compila la scheda"}),e.jsx("p",{className:"hint",children:"Aggiungi esercizi uno alla volta per completare il programma."}),z.map((a,s)=>e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px solid rgba(18,18,18,0.10)"},children:[e.jsxs("h2",{children:["Esercizio ",s+1]}),e.jsxs("label",{children:["Nome esercizio",e.jsx("input",{value:a.name,onChange:t=>x(s,{name:t.target.value}),placeholder:"Es. Squat bilanciere"})]}),e.jsxs("label",{children:["Numero serie",e.jsx("input",{type:"number",min:1,value:a.sets,onChange:t=>x(s,{sets:Number(t.target.value)})})]}),e.jsxs("label",{children:["Ripetizioni",e.jsx("input",{value:a.reps,onChange:t=>x(s,{reps:t.target.value}),placeholder:"Es. 8-10"})]}),e.jsxs("label",{children:["Peso",e.jsx("input",{value:a.weight,onChange:t=>x(s,{weight:t.target.value}),placeholder:"Es. 40kg o corpo libero"})]}),e.jsxs("label",{children:["URL video o immagine",e.jsx("input",{value:a.mediaUrl,onChange:t=>x(s,{mediaUrl:t.target.value}),placeholder:"https://..."})]}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>Q(s),children:"Rimuovi esercizio"})]},`exercise-${s}`)),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:G,children:"Aggiungi esercizio"}),e.jsx("button",{className:"btn",type:"button",disabled:j,onClick:()=>void F(),children:r?"Salva modifiche":"Salva scheda tecnica"}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>C(!1),children:"Chiudi"})]})}):null,m==="admin"?e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Gestione accessi"}),e.jsxs("label",{children:["Codice utente",e.jsx("input",{value:y,onChange:a=>D(a.target.value),placeholder:"Inserisci il codice utente"})]}),e.jsxs("label",{children:["Profilo accesso",e.jsxs("select",{value:R,onChange:a=>q(a.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"trainer",children:"Coach"}),e.jsx("option",{value:"client",children:"Cliente"})]})]}),e.jsx("button",{className:"btn",disabled:!y||j,onClick:()=>void U(()=>Z(y,R),"Accesso aggiornato."),type:"button",children:"Aggiorna accesso"})]}):null,e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Panoramica"}),e.jsxs("p",{className:"hint",children:["Clienti registrati: ",f.length]}),e.jsxs("p",{className:"hint",children:["Programmi creati: ",v.length]}),e.jsx("ul",{className:"list",children:v.slice(0,5).map(a=>{var s;return e.jsxs("li",{children:[e.jsx("strong",{children:a.title})," · ",((s=a.exercises)==null?void 0:s.length)??0," esercizi · cliente ",a.clientId]},a.id)})})]}),j?e.jsx("p",{className:"message",children:"Caricamento..."}):null]})}export{te as CoachDashboardPage};
