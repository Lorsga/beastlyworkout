import{u as q,r as a,j as e,o as G,f as L,h as B,p as H,q as J,s as K}from"./index-CY9Vfv5N.js";import{A as O}from"./AppShell-DlxCqYvP.js";import{t as P}from"./firestore-BAizMrXz.js";function Y(){const{role:l}=q(),[d,R]=a.useState([]),[S,T]=a.useState([]),[k,E]=a.useState([]),[v,c]=a.useState(""),[C,b]=a.useState(""),[r,o]=a.useState(!1),[n,f]=a.useState(""),[u,U]=a.useState(""),[N,M]=a.useState("check-in"),[h,D]=a.useState(""),[p,I]=a.useState(""),[m,w]=a.useState(""),[y,z]=a.useState("client");async function A(){var s;if(l){o(!0),c("");try{const[i,x,F]=await Promise.all([G(),L(l),B(l)]),j=i.docs.map(t=>({id:t.id,...t.data()})).filter(t=>t.role==="client"||t.requestedRole==="client");R(j),!n&&((s=j[0])!=null&&s.id)&&f(j[0].id),T(x.docs.map(t=>({id:t.id,...t.data()}))),E(F.docs.map(t=>({id:t.id,...t.data()})))}catch(i){c(P(i))}finally{o(!1)}}}a.useEffect(()=>{A()},[l]);async function g(s,i){b(""),c(""),o(!0);try{await s(),b(i),await A()}catch(x){c(P(x))}finally{o(!1)}}return e.jsxs(O,{role:l==="trainer"?"trainer":"admin",subtitle:"Gestisci clienti, programmi e appuntamenti da un unico posto.",title:"Area Coach",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Scegli un cliente"}),e.jsxs("label",{children:["Clienti registrati",e.jsxs("select",{value:n,onChange:s=>f(s.target.value),children:[d.length===0?e.jsx("option",{value:"",children:"Nessun cliente disponibile"}):null,d.map(s=>{var i;return e.jsx("option",{value:s.id,children:((i=s.displayName)==null?void 0:i.trim())||s.email||s.id},s.id)})]})]}),e.jsx("p",{className:"hint",children:"Il cliente scelto sarà usato per creare schede e sessioni."})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Crea un programma"}),e.jsxs("label",{children:["Titolo programma",e.jsx("input",{value:u,onChange:s=>U(s.target.value),placeholder:"Forza 4 settimane"})]}),e.jsx("button",{className:"btn",disabled:!n||!u||r,onClick:()=>void g(()=>H({clientId:n,title:u,status:"active"}),"Scheda creata e già disponibile al cliente."),type:"button",children:"Salva programma"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Agenda sessioni (opzionale)"}),e.jsx("p",{className:"hint",children:"Ti aiuta a segnare appuntamenti, check-in e richiami con il cliente."}),e.jsxs("label",{children:["Data e ora inizio",e.jsx("input",{value:h,onChange:s=>D(s.target.value),type:"datetime-local"})]}),e.jsxs("label",{children:["Data e ora fine",e.jsx("input",{value:p,onChange:s=>I(s.target.value),type:"datetime-local"})]}),e.jsxs("label",{children:["Tipo sessione",e.jsx("input",{value:N,onChange:s=>M(s.target.value),placeholder:"Es. allenamento, check-in"})]}),e.jsx("button",{className:"btn",disabled:!n||!h||!p||r,onClick:()=>void g(()=>J({clientId:n,startsAt:h,endsAt:p,type:N}),"Sessione pianificata con successo."),type:"button",children:"Salva sessione"})]}),l==="admin"?e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Gestione accessi"}),e.jsxs("label",{children:["Codice utente",e.jsx("input",{value:m,onChange:s=>w(s.target.value),placeholder:"Inserisci il codice utente"})]}),e.jsxs("label",{children:["Profilo accesso",e.jsxs("select",{value:y,onChange:s=>z(s.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"trainer",children:"Coach"}),e.jsx("option",{value:"client",children:"Cliente"})]})]}),e.jsx("button",{className:"btn",disabled:!m||r,onClick:()=>void g(()=>K(m,y),"Accesso aggiornato."),type:"button",children:"Aggiorna accesso"})]}):null,e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Panoramica"}),e.jsxs("p",{className:"hint",children:["Clienti registrati: ",d.length]}),e.jsxs("p",{className:"hint",children:["Programmi creati: ",S.length]}),e.jsxs("p",{className:"hint",children:["Sessioni in agenda: ",k.length]}),e.jsx("ul",{className:"list",children:S.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.title})," · ",s.status," · cliente ",s.clientId]},s.id))})]}),r?e.jsx("p",{className:"message",children:"Caricamento..."}):null,C?e.jsx("p",{className:"message success",children:C}):null,v?e.jsx("p",{className:"message",children:v}):null]})}export{Y as CoachDashboardPage};
