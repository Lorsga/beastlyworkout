import{u as J,a as K,r as a,j as e,N as Q,f as X,h as Y,i as Z,k as _,m as $,n as ee,o as se}from"./index-SH5Io-fT.js";import{A as ae}from"./AppShell-BuFMNnmg.js";import{m as o,t as w}from"./firestore-BAizMrXz.js";function le(){const{role:x,user:l}=J(),u=K(),[P,T]=a.useState([]),[d,L]=a.useState([]),[j,E]=a.useState([]),[I,R]=a.useState([]),[S,r]=a.useState(""),[f,v]=a.useState(""),[h,c]=a.useState(!1),[i,b]=a.useState(""),[m,U]=a.useState(""),[N,F]=a.useState(""),[C,O]=a.useState("weight"),[y,V]=a.useState(0),[D,W]=a.useState("kg"),[g,z]=a.useState(""),[q,B]=a.useState(!0);a.useEffect(()=>{async function s(){if(l)try{const n=(await X(l.uid)).data();if(!(n!=null&&n.onboardingCompleted)){u("/onboarding",{replace:!0});return}}catch{u("/onboarding",{replace:!0});return}finally{B(!1)}}s()},[l,u]);async function A(){var s;c(!0),r("");try{const[t,n,G,H]=await Promise.all([Y("client"),Z("client"),_(),$()]),p=o(t.docs);T(p),L(o(n.docs)),E(o(G.docs)),R(o(H.docs)),!i&&((s=p[0])!=null&&s.trainerId)&&b(p[0].trainerId)}catch(t){r(w(t))}finally{c(!1)}}if(a.useEffect(()=>{x==="client"&&A()},[x]),!l)return e.jsx(Q,{to:"/auth",replace:!0});if(q)return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Prepariamo la tua area"}),e.jsx("p",{className:"hero-sub",children:"Sto verificando le informazioni del tuo profilo..."})]})});async function M(s,t){v(""),r(""),c(!0);try{await s(),v(t),await A()}catch(n){r(w(n))}finally{c(!1)}}const k=a.useMemo(()=>[...d].sort((s,t)=>new Date(s.startsAt).getTime()-new Date(t.startsAt).getTime()).find(s=>new Date(s.startsAt).getTime()>Date.now()),[d]);return e.jsxs(ae,{role:"client",subtitle:"Tieni traccia di allenamenti e progressi in modo semplice.",title:"La tua area",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Riepilogo"}),e.jsxs("p",{className:"hint",children:["Programmi ricevuti: ",P.length]}),e.jsxs("p",{className:"hint",children:["Sessioni prenotate: ",d.length]}),e.jsxs("p",{className:"hint",children:["Allenamenti registrati: ",j.length]}),e.jsxs("p",{className:"hint",children:["Progressi inseriti: ",I.length]}),k?e.jsxs("p",{className:"message success",children:["Prossima sessione: ",new Date(k.startsAt).toLocaleString("it-IT")]}):null]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Codice Coach"}),e.jsxs("label",{children:["Codice del tuo coach",e.jsx("input",{value:i,onChange:s=>b(s.target.value),placeholder:"Inserisci il codice coach"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Registra allenamento"}),e.jsxs("label",{children:["Data allenamento",e.jsx("input",{value:m,onChange:s=>U(s.target.value),type:"date"})]}),e.jsxs("label",{children:["Com'è andata?",e.jsx("textarea",{value:N,onChange:s=>F(s.target.value),placeholder:"Scrivi come ti sei sentito durante l'allenamento"})]}),e.jsx("button",{className:"btn",disabled:!i||!m||h,onClick:()=>void M(()=>ee({trainerId:i,sessionDate:m,notes:N}),"Allenamento salvato."),type:"button",children:"Salva allenamento"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Aggiorna progressi"}),e.jsxs("label",{children:["Tipo di dato",e.jsx("input",{value:C,onChange:s=>O(s.target.value),placeholder:"Es. peso, massa grassa, frequenza"})]}),e.jsxs("label",{children:["Valore",e.jsx("input",{value:y,onChange:s=>V(Number(s.target.value)),type:"number"})]}),e.jsxs("label",{children:["Unità",e.jsx("input",{value:D,onChange:s=>W(s.target.value),placeholder:"Es. kg, %, bpm"})]}),e.jsxs("label",{children:["Data",e.jsx("input",{value:g,onChange:s=>z(s.target.value),type:"date"})]}),e.jsx("button",{className:"btn",disabled:!i||!g||h,onClick:()=>void M(()=>se({trainerId:i,metricType:C,value:y,unit:D,measuredAt:g}),"Progresso salvato."),type:"button",children:"Salva progresso"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Ultimi allenamenti"}),e.jsx("ul",{className:"list",children:j.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.sessionDate})," · ",s.notes||"Nessuna nota"]},s.id))})]}),h?e.jsx("p",{className:"message",children:"Caricamento..."}):null,f?e.jsx("p",{className:"message success",children:f}):null,S?e.jsx("p",{className:"message",children:S}):null]})}export{le as ClientDashboardPage};
