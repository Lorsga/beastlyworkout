import{u as N,a as A,r as u,c as C,j as e,N as d,L as I,l as p,b as S,d as v,g as w}from"./index-D3l-U9gv.js";import{t as h}from"./firestore-CSdz_xXz.js";const f=new Set(["lrnz.sga@gmail.com"]),n="bw_login_intent";function E(){const{user:r,role:i}=N(),c=A(),[l,o]=u.useState(!1),[m,t]=u.useState("");if(u.useEffect(()=>{C()},[]),r&&i)return sessionStorage.removeItem(n),e.jsx(d,{to:i==="client"?"/app/client":"/app/coach",replace:!0});if(r&&!i){const a=sessionStorage.getItem(n),s=f.has((r.email??"").toLowerCase());return a==="coach"&&s?e.jsx(d,{to:"/missing-role",replace:!0}):e.jsx(d,{to:"/onboarding",replace:!0})}async function x(){o(!0),t("");try{if(sessionStorage.setItem(n,"client"),(await p()).redirected){t("Apertura accesso Google...");return}c("/onboarding",{replace:!0})}catch(a){t(h(a))}finally{o(!1)}}async function b(){var a;o(!0),t("");try{sessionStorage.setItem(n,"coach");const s=await p();if(s.redirected){t("Apertura accesso Google...");return}if(!s.user){t("Accesso non completato. Riprova.");return}const j=((a=s.user.email)==null?void 0:a.toLowerCase())??"";if(!f.has(j)){await S(),t("Questo account non Ã¨ abilitato come PT/Admin. Usa accesso utente.");return}await v();const g=await w(s.user);if(g==="admin"||g==="trainer"){c("/app/coach",{replace:!0});return}c("/missing-role",{replace:!0})}catch(s){t(h(s))}finally{o(!1)}}return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accedi con Google"}),e.jsx("p",{className:"hero-sub",children:"Inizia subito: entra come utente e completa il tuo percorso iniziale."}),e.jsx("button",{className:"btn",disabled:l,onClick:()=>void x(),type:"button",children:l?"Connessione...":"Continua con Google"}),e.jsx("div",{className:"divider"}),e.jsx("h2",{children:"Sei PT/Admin?"}),e.jsx("p",{className:"hint",children:"Usa il tuo account autorizzato per entrare nell'area coach."}),e.jsx("button",{className:"btn btn-ghost",disabled:l,onClick:()=>void b(),type:"button",children:"Continua con Google (PT/Admin)"}),e.jsxs("p",{className:"hint",children:["Se non sei PT/Admin torna a ",e.jsx(I,{to:"/onboarding",children:"onboarding utente"}),"."]}),m?e.jsx("p",{className:"message",children:m}):null]})})}export{E as AuthPage};
