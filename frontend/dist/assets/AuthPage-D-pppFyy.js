import{u as b,a as j,r as u,c as N,j as e,N as d,L as A,l as g,b as v,d as y,g as C}from"./index-CubVF6E_.js";import{i as p}from"./admin-B5do5RBX.js";import{t as h}from"./firestore-CSdz_xXz.js";const o="bw_login_intent";function G(){const{user:r,role:i}=b(),c=j(),[l,a]=u.useState(!1),[m,s]=u.useState("");if(u.useEffect(()=>{N()},[]),r&&i)return sessionStorage.removeItem(o),e.jsx(d,{to:i==="client"?"/app/client":"/app/coach",replace:!0});if(r&&!i){const t=sessionStorage.getItem(o),n=p(r.email);return t==="coach"&&n?e.jsx(d,{to:"/missing-role",replace:!0}):e.jsx(d,{to:"/onboarding",replace:!0})}async function f(){a(!0),s("");try{if(sessionStorage.setItem(o,"client"),(await g()).redirected){s("Apertura accesso Google...");return}c("/onboarding",{replace:!0})}catch(t){s(h(t))}finally{a(!1)}}async function x(){a(!0),s("");try{sessionStorage.setItem(o,"coach");const t=await g();if(t.redirected){s("Apertura accesso Google...");return}if(!t.user){s("Accesso non completato. Riprova.");return}if(!p(t.user.email)){await v(),s("Questo account non Ã¨ abilitato come PT/Admin. Usa accesso utente.");return}await y();const n=await C(t.user);if(n==="admin"||n==="trainer"){c("/app/coach",{replace:!0});return}c("/missing-role",{replace:!0})}catch(t){s(h(t))}finally{a(!1)}}return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accedi con Google"}),e.jsx("p",{className:"hero-sub",children:"Inizia subito: entra come utente e completa il tuo percorso iniziale."}),e.jsx("button",{className:"btn",disabled:l,onClick:()=>void f(),type:"button",children:l?"Connessione...":"Continua con Google"}),e.jsx("div",{className:"divider"}),e.jsx("h2",{children:"Sei PT/Admin?"}),e.jsx("p",{className:"hint",children:"Usa il tuo account autorizzato per entrare nell'area coach."}),e.jsx("button",{className:"btn btn-ghost",disabled:l,onClick:()=>void x(),type:"button",children:"Continua con Google (PT/Admin)"}),e.jsxs("p",{className:"hint",children:["Se non sei PT/Admin torna a ",e.jsx(A,{to:"/onboarding",children:"onboarding utente"}),"."]}),m?e.jsx("p",{className:"message",children:m}):null]})})}export{G as AuthPage};
