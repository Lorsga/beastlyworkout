import{u as H,b as J,r as l,j as e,q as K,s as Q,i as V,t as X,v as Y}from"./index-3QNxYYV6.js";import{A as Z}from"./AppShell-yVEMZXoe.js";import{t as k}from"./firestore-BAizMrXz.js";function se(){var z,R;const{role:c,user:o}=H(),{showError:d,showSuccess:L}=J(),[b,I]=l.useState([]),[y,T]=l.useState([]),[p,g]=l.useState(!1),[i,v]=l.useState(null),[D,N]=l.useState(!1),[r,w]=l.useState(""),[x,P]=l.useState(""),[U,j]=l.useState([{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}]),[f,M]=l.useState(""),[A,q]=l.useState("client");l.useEffect(()=>{async function a(){if(!r){v(null);return}try{const s=await K(r,"onboarding");v(s.data()??null)}catch{v(null)}}a()},[r]);async function C(){var a;if(c){g(!0);try{const[s,t]=await Promise.all([Q(),V(c)]),m=s.docs.map(n=>({id:n.id,...n.data()})).filter(n=>n.id!==(o==null?void 0:o.uid)).sort((n,S)=>{const $=(n.displayName||n.email||n.id).toLowerCase(),B=(S.displayName||S.email||S.id).toLowerCase();return $.localeCompare(B)});I(m),!r&&((a=m[0])!=null&&a.id)&&w(m[0].id),T(t.docs.map(n=>({id:n.id,...n.data()})))}catch(s){d(k(s))}finally{g(!1)}}}l.useEffect(()=>{C()},[c,o==null?void 0:o.uid]);async function E(a,s){g(!0);try{await a(),L(s),await C()}catch(t){d(k(t))}finally{g(!1)}}function F(){j(a=>[...a,{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}])}function G(a){j(s=>s.length<=1?s:s.filter((t,u)=>u!==a))}function h(a,s){j(t=>t.map((u,m)=>m===a?{...u,...s}:u))}async function W(){const a=U.map(s=>({name:s.name.trim(),sets:Number(s.sets)||0,reps:s.reps.trim(),weight:s.weight.trim(),mediaUrl:s.mediaUrl.trim()})).filter(s=>s.name.length>0);if(a.length===0){d("Aggiungi almeno un esercizio con nome.");return}await E(()=>X({clientId:r,title:x,status:"active",exercises:a}),"Scheda salvata e subito visibile al cliente."),P(""),j([{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}]),N(!1)}function _(){if(!r){d("Seleziona prima un cliente.");return}if(!x.trim()){d("Inserisci un titolo per la scheda.");return}N(!0)}return e.jsxs(Z,{role:c==="trainer"?"trainer":"admin",subtitle:"Gestisci clienti, programmi e appuntamenti da un unico posto.",title:"Area Coach",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Crea scheda cliente"}),e.jsxs("label",{children:["Clienti registrati",e.jsxs("select",{value:r,onChange:a=>w(a.target.value),children:[b.length===0?e.jsx("option",{value:"",children:"Nessun cliente disponibile"}):null,b.map(a=>{var s;return e.jsx("option",{value:a.id,children:((s=a.displayName)==null?void 0:s.trim())||a.email||a.id},a.id)})]})]}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>void C(),children:"Aggiorna lista clienti"}),e.jsxs("label",{children:["Titolo programma",e.jsx("input",{value:x,onChange:a=>P(a.target.value),placeholder:"Forza 4 settimane"})]}),e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px dashed rgba(18,18,18,0.16)"},children:[e.jsx("h2",{children:"Informazioni del cliente"}),e.jsxs("p",{className:"hint",children:["Obiettivo: ",((z=i==null?void 0:i.goal)==null?void 0:z.trim())||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Livello: ",(i==null?void 0:i.experienceLevel)||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Allenamenti a settimana: ",(i==null?void 0:i.trainingDaysPerWeek)??"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Note: ",((R=i==null?void 0:i.notes)==null?void 0:R.trim())||"Nessuna nota inserita"]})]}),e.jsx("button",{className:"btn",disabled:!r||!x||p,onClick:_,type:"button",children:"Crea scheda"})]}),D?e.jsx("section",{className:"modal-overlay",role:"dialog","aria-modal":"true",children:e.jsxs("article",{className:"card modal-card",children:[e.jsx("h2",{children:"Compila la scheda"}),e.jsx("p",{className:"hint",children:"Aggiungi esercizi uno alla volta per completare il programma."}),U.map((a,s)=>e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px solid rgba(18,18,18,0.10)"},children:[e.jsxs("h2",{children:["Esercizio ",s+1]}),e.jsxs("label",{children:["Nome esercizio",e.jsx("input",{value:a.name,onChange:t=>h(s,{name:t.target.value}),placeholder:"Es. Squat bilanciere"})]}),e.jsxs("label",{children:["Numero serie",e.jsx("input",{type:"number",min:1,value:a.sets,onChange:t=>h(s,{sets:Number(t.target.value)})})]}),e.jsxs("label",{children:["Ripetizioni",e.jsx("input",{value:a.reps,onChange:t=>h(s,{reps:t.target.value}),placeholder:"Es. 8-10"})]}),e.jsxs("label",{children:["Peso",e.jsx("input",{value:a.weight,onChange:t=>h(s,{weight:t.target.value}),placeholder:"Es. 40kg o corpo libero"})]}),e.jsxs("label",{children:["URL video o immagine",e.jsx("input",{value:a.mediaUrl,onChange:t=>h(s,{mediaUrl:t.target.value}),placeholder:"https://..."})]}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>G(s),children:"Rimuovi esercizio"})]},`exercise-${s}`)),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:F,children:"Aggiungi esercizio"}),e.jsx("button",{className:"btn",type:"button",disabled:p,onClick:()=>void W(),children:"Salva scheda tecnica"}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>N(!1),children:"Chiudi"})]})}):null,c==="admin"?e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Gestione accessi"}),e.jsxs("label",{children:["Codice utente",e.jsx("input",{value:f,onChange:a=>M(a.target.value),placeholder:"Inserisci il codice utente"})]}),e.jsxs("label",{children:["Profilo accesso",e.jsxs("select",{value:A,onChange:a=>q(a.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"trainer",children:"Coach"}),e.jsx("option",{value:"client",children:"Cliente"})]})]}),e.jsx("button",{className:"btn",disabled:!f||p,onClick:()=>void E(()=>Y(f,A),"Accesso aggiornato."),type:"button",children:"Aggiorna accesso"})]}):null,e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Panoramica"}),e.jsxs("p",{className:"hint",children:["Clienti registrati: ",b.length]}),e.jsxs("p",{className:"hint",children:["Programmi creati: ",y.length]}),e.jsx("ul",{className:"list",children:y.slice(0,5).map(a=>{var s;return e.jsxs("li",{children:[e.jsx("strong",{children:a.title})," · ",((s=a.exercises)==null?void 0:s.length)??0," esercizi · cliente ",a.clientId]},a.id)})})]}),p?e.jsx("p",{className:"message",children:"Caricamento..."}):null]})}export{se as CoachDashboardPage};
