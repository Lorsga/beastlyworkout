import{u as B,r as a,j as e,p as H,q as J,h as K,i as Q,s as V,t as X,v as Y}from"./index-SH5Io-fT.js";import{A as Z}from"./AppShell-BuFMNnmg.js";import{t as E}from"./firestore-BAizMrXz.js";function se(){var R,k;const{role:c}=B(),[h,U]=a.useState([]),[b,D]=a.useState([]),[w,M]=a.useState([]),[N,r]=a.useState(""),[f,C]=a.useState(""),[o,d]=a.useState(!1),[t,u]=a.useState(null),[l,y]=a.useState(""),[p,z]=a.useState(""),[A,I]=a.useState("check-in"),[m,F]=a.useState(""),[x,L]=a.useState(""),[g,G]=a.useState(""),[P,q]=a.useState("client");a.useEffect(()=>{async function s(){if(!l){u(null);return}try{const n=await H(l,"onboarding");u(n.data()??null)}catch{u(null)}}s()},[l]);async function T(){var s;if(c){d(!0),r("");try{const[n,S,W]=await Promise.all([J(),K(c),Q(c)]),v=n.docs.map(i=>({id:i.id,...i.data()})).filter(i=>i.role!=="admin"&&i.role!=="trainer");U(v),!l&&((s=v[0])!=null&&s.id)&&y(v[0].id),D(S.docs.map(i=>({id:i.id,...i.data()}))),M(W.docs.map(i=>({id:i.id,...i.data()})))}catch(n){r(E(n))}finally{d(!1)}}}a.useEffect(()=>{T()},[c]);async function j(s,n){C(""),r(""),d(!0);try{await s(),C(n),await T()}catch(S){r(E(S))}finally{d(!1)}}return e.jsxs(Z,{role:c==="trainer"?"trainer":"admin",subtitle:"Gestisci clienti, programmi e appuntamenti da un unico posto.",title:"Area Coach",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Crea scheda cliente"}),e.jsxs("label",{children:["Clienti registrati",e.jsxs("select",{value:l,onChange:s=>y(s.target.value),children:[h.length===0?e.jsx("option",{value:"",children:"Nessun cliente disponibile"}):null,h.map(s=>{var n;return e.jsx("option",{value:s.id,children:((n=s.displayName)==null?void 0:n.trim())||s.email||s.id},s.id)})]})]}),e.jsxs("label",{children:["Titolo programma",e.jsx("input",{value:p,onChange:s=>z(s.target.value),placeholder:"Forza 4 settimane"})]}),e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px dashed rgba(18,18,18,0.16)"},children:[e.jsx("h2",{children:"Informazioni del cliente"}),e.jsxs("p",{className:"hint",children:["Obiettivo: ",((R=t==null?void 0:t.goal)==null?void 0:R.trim())||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Livello: ",(t==null?void 0:t.experienceLevel)||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Allenamenti a settimana: ",(t==null?void 0:t.trainingDaysPerWeek)??"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Note: ",((k=t==null?void 0:t.notes)==null?void 0:k.trim())||"Nessuna nota inserita"]})]}),e.jsx("button",{className:"btn",disabled:!l||!p||o,onClick:()=>void j(()=>V({clientId:l,title:p,status:"active"}),"Scheda creata e già disponibile al cliente."),type:"button",children:"Salva programma"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Agenda sessioni (opzionale)"}),e.jsx("p",{className:"hint",children:"Ti aiuta a segnare appuntamenti, check-in e richiami con il cliente."}),e.jsxs("label",{children:["Data e ora inizio",e.jsx("input",{value:m,onChange:s=>F(s.target.value),type:"datetime-local"})]}),e.jsxs("label",{children:["Data e ora fine",e.jsx("input",{value:x,onChange:s=>L(s.target.value),type:"datetime-local"})]}),e.jsxs("label",{children:["Tipo sessione",e.jsx("input",{value:A,onChange:s=>I(s.target.value),placeholder:"Es. allenamento, check-in"})]}),e.jsx("button",{className:"btn",disabled:!l||!m||!x||o,onClick:()=>void j(()=>X({clientId:l,startsAt:m,endsAt:x,type:A}),"Sessione pianificata con successo."),type:"button",children:"Salva sessione"})]}),c==="admin"?e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Gestione accessi"}),e.jsxs("label",{children:["Codice utente",e.jsx("input",{value:g,onChange:s=>G(s.target.value),placeholder:"Inserisci il codice utente"})]}),e.jsxs("label",{children:["Profilo accesso",e.jsxs("select",{value:P,onChange:s=>q(s.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"trainer",children:"Coach"}),e.jsx("option",{value:"client",children:"Cliente"})]})]}),e.jsx("button",{className:"btn",disabled:!g||o,onClick:()=>void j(()=>Y(g,P),"Accesso aggiornato."),type:"button",children:"Aggiorna accesso"})]}):null,e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Panoramica"}),e.jsxs("p",{className:"hint",children:["Clienti registrati: ",h.length]}),e.jsxs("p",{className:"hint",children:["Programmi creati: ",b.length]}),e.jsxs("p",{className:"hint",children:["Sessioni in agenda: ",w.length]}),e.jsx("ul",{className:"list",children:b.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.title})," · ",s.status," · cliente ",s.clientId]},s.id))})]}),o?e.jsx("p",{className:"message",children:"Caricamento..."}):null,f?e.jsx("p",{className:"message success",children:f}):null,N?e.jsx("p",{className:"message",children:N}):null]})}export{se as CoachDashboardPage};
