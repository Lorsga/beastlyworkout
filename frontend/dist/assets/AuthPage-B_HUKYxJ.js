import{u as E,a as R,r as i,c as T,j as e,N as x,l as b,b as j,d as A,g as S,e as w}from"./index-SH5Io-fT.js";import{t as h}from"./firestore-BAizMrXz.js";const z=["lrnz.sga@gmail.com"];function y(t){return t.trim().toLowerCase()}function G(t){const o=z.join(",");return new Set(o.split(",").map(y).filter(Boolean))}const _=G();function g(t){return t?_.has(y(t)):!1}const c="bw_login_intent";function M(){const{user:t,role:o}=E(),r=R(),[d,l]=i.useState(!1),[u,s]=i.useState(""),[f,N]=i.useState(!1);if(i.useEffect(()=>{T()},[]),i.useEffect(()=>{async function a(){if(!(!t||o||sessionStorage.getItem(c)!=="coach"||!g(t.email))){N(!0),s("Sto preparando il tuo accesso coach...");try{await j({email:t.email??"",displayName:t.displayName??"",coachAccessRequestedAt:new Date().toISOString()});for(let n=0;n<10;n+=1){await A();const m=await S(t);if(m==="admin"||m==="trainer"){sessionStorage.removeItem(c),r("/app/coach",{replace:!0});return}await new Promise(v=>setTimeout(v,700))}s("Sto ancora completando l’accesso. Riprova tra pochi secondi.")}catch(n){s(h(n))}finally{N(!1)}}}a()},[t,o,r]),t&&o)return sessionStorage.removeItem(c),e.jsx(x,{to:o==="client"?"/app/client":"/app/coach",replace:!0});if(t&&!o)return sessionStorage.getItem(c)==="coach"&&g(t.email)?e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accesso Coach"}),e.jsx("p",{className:"hero-sub",children:f?"Attendi un attimo...":"Sto verificando il tuo account."}),u?e.jsx("p",{className:"message",children:u}):null,e.jsx("button",{className:"btn btn-ghost",disabled:f,onClick:()=>void b(),type:"button",children:"Esci e cambia account"})]})}):e.jsx(x,{to:"/app/client",replace:!0});async function C(){l(!0),s("");try{if(sessionStorage.setItem(c,"client"),(await w()).redirected){s("Ti sto reindirizzando a Google...");return}r("/app/client",{replace:!0})}catch(a){s(h(a))}finally{l(!1)}}async function I(){l(!0),s("");try{sessionStorage.setItem(c,"coach");const a=await w();if(a.redirected){s("Ti sto reindirizzando a Google...");return}if(!a.user){s("Accesso non completato. Riprova.");return}if(!g(a.user.email)){await b(),s("Questo account non è abilitato per l’area coach. Usa accesso utente.");return}await j({email:a.user.email??"",displayName:a.user.displayName??"",coachAccessRequestedAt:new Date().toISOString()});for(let p=0;p<8;p+=1){await A();const n=await S(a.user);if(n==="admin"||n==="trainer"){sessionStorage.removeItem(c),r("/app/coach",{replace:!0});return}await new Promise(m=>setTimeout(m,700))}s("Sto ancora completando l’accesso coach. Riprova tra qualche secondo.")}catch(a){s(h(a))}finally{l(!1)}}return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accedi con Google"}),e.jsx("p",{className:"hero-sub",children:"Entra in pochi secondi e inizia subito il tuo percorso."}),e.jsx("button",{className:"btn",disabled:d,onClick:()=>void C(),type:"button",children:d?"Connessione...":"Continua con Google"}),e.jsx("div",{className:"divider"}),e.jsx("h2",{children:"Sei un Coach?"}),e.jsx("p",{className:"hint",children:"Usa il tuo account coach per entrare nell'area professionale."}),e.jsx("button",{className:"btn btn-ghost",disabled:d,onClick:()=>void I(),type:"button",children:"Continua come Coach"}),u?e.jsx("p",{className:"message",children:u}):null]})})}export{M as AuthPage};
