import{u as R,a as M,b as T,r as l,c as z,j as e,N as b,l as j,d as w,e as A,g as S,f as y}from"./index-BG4rOQnM.js";import{t as g}from"./firestore-BAizMrXz.js";const G=["lrnz.sga@gmail.com"];function C(t){return t.trim().toLowerCase()}function _(t){const n=G.join(",");return new Set(n.split(",").map(C).filter(Boolean))}const k=_();function f(t){return t?k.has(C(t)):!1}const i="bw_login_intent";function D(){const{user:t,role:n}=R(),u=M(),{showError:m}=T(),[h,d]=l.useState(!1),[p,s]=l.useState(""),[x,N]=l.useState(!1);if(l.useEffect(()=>{z()},[]),l.useEffect(()=>{async function a(){if(!(!t||n||sessionStorage.getItem(i)!=="coach"||!f(t.email))){N(!0),s("Sto preparando il tuo accesso coach...");try{await w({email:t.email??"",displayName:t.displayName??"",coachAccessRequestedAt:new Date().toISOString()});for(let c=0;c<10;c+=1){await A();const r=await S(t);if(r==="admin"||r==="trainer"){sessionStorage.removeItem(i),u("/app/coach",{replace:!0});return}await new Promise(E=>setTimeout(E,700))}s("Sto ancora completando l’accesso. Riprova tra pochi secondi.")}catch(c){const r=g(c);s(r),m(r)}finally{N(!1)}}}a()},[t,n,u]),t&&n)return sessionStorage.removeItem(i),e.jsx(b,{to:n==="client"?"/app/client":"/app/coach",replace:!0});if(t&&!n)return sessionStorage.getItem(i)==="coach"&&f(t.email)?e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accesso Coach"}),e.jsx("p",{className:"hero-sub",children:x?"Attendi un attimo...":"Sto verificando il tuo account."}),p?e.jsx("p",{className:"message",children:p}):null,e.jsx("button",{className:"btn btn-ghost",disabled:x,onClick:()=>void j(),type:"button",children:"Esci e cambia account"})]})}):e.jsx(b,{to:"/app/client",replace:!0});async function I(){d(!0),s("");try{if(sessionStorage.setItem(i,"client"),(await y()).redirected){s("Ti sto reindirizzando a Google...");return}u("/app/client",{replace:!0})}catch(a){const o=g(a);s(o),m(o)}finally{d(!1)}}async function v(){d(!0),s("");try{sessionStorage.setItem(i,"coach");const a=await y();if(a.redirected){s("Ti sto reindirizzando a Google...");return}if(!a.user){s("Accesso non completato. Riprova.");return}if(!f(a.user.email)){await j(),s("Questo account non è abilitato per l’area coach. Usa accesso utente."),m("Questo account non è abilitato per l’area coach.");return}await w({email:a.user.email??"",displayName:a.user.displayName??"",coachAccessRequestedAt:new Date().toISOString()});for(let o=0;o<8;o+=1){await A();const c=await S(a.user);if(c==="admin"||c==="trainer"){sessionStorage.removeItem(i),u("/app/coach",{replace:!0});return}await new Promise(r=>setTimeout(r,700))}s("Sto ancora completando l’accesso coach. Riprova tra qualche secondo.")}catch(a){const o=g(a);s(o),m(o)}finally{d(!1)}}return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accedi con Google"}),e.jsx("p",{className:"hero-sub",children:"Entra in pochi secondi e inizia subito il tuo percorso."}),e.jsx("button",{className:"btn",disabled:h,onClick:()=>void I(),type:"button",children:h?"Connessione...":"Continua con Google"}),e.jsx("div",{className:"divider"}),e.jsx("h2",{children:"Sei un Coach?"}),e.jsx("p",{className:"hint",children:"Usa il tuo account coach per entrare nell'area professionale."}),e.jsx("button",{className:"btn btn-ghost",disabled:h,onClick:()=>void v(),type:"button",children:"Continua come Coach"}),p?e.jsx("p",{className:"message",children:p}):null]})})}export{D as AuthPage};
