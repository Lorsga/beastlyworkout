import{u as G,a as H,b as J,r as a,j as e,N as K,h as Q,i as X,k as Y,m as Z,n as _,o as $,p as ee}from"./index-BG4rOQnM.js";import{A as se}from"./AppShell-BEEjIjcW.js";import{m as o,t as A}from"./firestore-BAizMrXz.js";function ie(){const{role:p,user:r}=G(),c=H(),{showError:x,showSuccess:w}=J(),[k,P]=a.useState([]),[u,T]=a.useState([]),[j,M]=a.useState([]),[L,E]=a.useState([]),[d,l]=a.useState(!1),[i,S]=a.useState(""),[h,I]=a.useState(""),[f,R]=a.useState(""),[b,U]=a.useState("weight"),[v,F]=a.useState(0),[N,O]=a.useState("kg"),[m,V]=a.useState(""),[W,z]=a.useState(!0);a.useEffect(()=>{async function s(){if(r)try{const n=(await Q(r.uid)).data();if(!(n!=null&&n.onboardingCompleted)){c("/onboarding",{replace:!0});return}}catch{c("/onboarding",{replace:!0});return}finally{z(!1)}}s()},[r,c]);async function C(){var s;l(!0);try{const[t,n,q,B]=await Promise.all([X("client"),Y("client"),Z(),_()]),g=o(t.docs);P(g),T(o(n.docs)),M(o(q.docs)),E(o(B.docs)),!i&&((s=g[0])!=null&&s.trainerId)&&S(g[0].trainerId)}catch(t){x(A(t))}finally{l(!1)}}if(a.useEffect(()=>{p==="client"&&C()},[p]),!r)return e.jsx(K,{to:"/auth",replace:!0});if(W)return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Prepariamo la tua area"}),e.jsx("p",{className:"hero-sub",children:"Sto verificando le informazioni del tuo profilo..."})]})});async function y(s,t){l(!0);try{await s(),w(t),await C()}catch(n){x(A(n))}finally{l(!1)}}const D=a.useMemo(()=>[...u].sort((s,t)=>new Date(s.startsAt).getTime()-new Date(t.startsAt).getTime()).find(s=>new Date(s.startsAt).getTime()>Date.now()),[u]);return e.jsxs(se,{role:"client",subtitle:"Tieni traccia di allenamenti e progressi in modo semplice.",title:"La tua area",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Riepilogo"}),e.jsxs("p",{className:"hint",children:["Programmi ricevuti: ",k.length]}),e.jsxs("p",{className:"hint",children:["Sessioni prenotate: ",u.length]}),e.jsxs("p",{className:"hint",children:["Allenamenti registrati: ",j.length]}),e.jsxs("p",{className:"hint",children:["Progressi inseriti: ",L.length]}),D?e.jsxs("p",{className:"message success",children:["Prossima sessione: ",new Date(D.startsAt).toLocaleString("it-IT")]}):null]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Codice Coach"}),e.jsxs("label",{children:["Codice del tuo coach",e.jsx("input",{value:i,onChange:s=>S(s.target.value),placeholder:"Inserisci il codice coach"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Registra allenamento"}),e.jsxs("label",{children:["Data allenamento",e.jsx("input",{value:h,onChange:s=>I(s.target.value),type:"date"})]}),e.jsxs("label",{children:["Com'è andata?",e.jsx("textarea",{value:f,onChange:s=>R(s.target.value),placeholder:"Scrivi come ti sei sentito durante l'allenamento"})]}),e.jsx("button",{className:"btn",disabled:!i||!h||d,onClick:()=>void y(()=>$({trainerId:i,sessionDate:h,notes:f}),"Allenamento salvato."),type:"button",children:"Salva allenamento"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Aggiorna progressi"}),e.jsxs("label",{children:["Tipo di dato",e.jsx("input",{value:b,onChange:s=>U(s.target.value),placeholder:"Es. peso, massa grassa, frequenza"})]}),e.jsxs("label",{children:["Valore",e.jsx("input",{value:v,onChange:s=>F(Number(s.target.value)),type:"number"})]}),e.jsxs("label",{children:["Unità",e.jsx("input",{value:N,onChange:s=>O(s.target.value),placeholder:"Es. kg, %, bpm"})]}),e.jsxs("label",{children:["Data",e.jsx("input",{value:m,onChange:s=>V(s.target.value),type:"date"})]}),e.jsx("button",{className:"btn",disabled:!i||!m||d,onClick:()=>void y(()=>ee({trainerId:i,metricType:b,value:v,unit:N,measuredAt:m}),"Progresso salvato."),type:"button",children:"Salva progresso"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Ultimi allenamenti"}),e.jsx("ul",{className:"list",children:j.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.sessionDate})," · ",s.notes||"Nessuna nota"]},s.id))})]}),d?e.jsx("p",{className:"message",children:"Caricamento..."}):null]})}export{ie as ClientDashboardPage};
