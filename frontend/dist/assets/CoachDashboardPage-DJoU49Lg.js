import{u as F,b as G,r as l,j as e,q as M,s as W,i as _,t as $,v as B}from"./index-B1UY7gjC.js";import{A as H}from"./AppShell-D9sg1TQ4.js";import{t as A}from"./firestore-BAizMrXz.js";function V(){var E,P;const{role:o}=F(),{showError:p,showSuccess:R}=G(),[g,z]=l.useState([]),[f,k]=l.useState([]),[x,u]=l.useState(!1),[i,j]=l.useState(null),[r,N]=l.useState(""),[b,S]=l.useState(""),[C,m]=l.useState([{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}]),[v,T]=l.useState(""),[y,D]=l.useState("client");l.useEffect(()=>{async function s(){if(!r){j(null);return}try{const a=await M(r,"onboarding");j(a.data()??null)}catch{j(null)}}s()},[r]);async function w(){var s;if(o){u(!0);try{const[a,t]=await Promise.all([W(),_(o)]),h=a.docs.map(n=>({id:n.id,...n.data()})).filter(n=>n.role!=="admin"&&n.role!=="trainer");z(h),!r&&((s=h[0])!=null&&s.id)&&N(h[0].id),k(t.docs.map(n=>({id:n.id,...n.data()})))}catch(a){p(A(a))}finally{u(!1)}}}l.useEffect(()=>{w()},[o]);async function U(s,a){u(!0);try{await s(),R(a),await w()}catch(t){p(A(t))}finally{u(!1)}}function I(){m(s=>[...s,{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}])}function L(s){m(a=>a.length<=1?a:a.filter((t,d)=>d!==s))}function c(s,a){m(t=>t.map((d,h)=>h===s?{...d,...a}:d))}async function q(){const s=C.map(a=>({name:a.name.trim(),sets:Number(a.sets)||0,reps:a.reps.trim(),weight:a.weight.trim(),mediaUrl:a.mediaUrl.trim()})).filter(a=>a.name.length>0);if(s.length===0){p("Aggiungi almeno un esercizio con nome.");return}await U(()=>$({clientId:r,title:b,status:"active",exercises:s}),"Scheda salvata e subito visibile al cliente."),S(""),m([{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}])}return e.jsxs(H,{role:o==="trainer"?"trainer":"admin",subtitle:"Gestisci clienti, programmi e appuntamenti da un unico posto.",title:"Area Coach",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Crea scheda cliente"}),e.jsxs("label",{children:["Clienti registrati",e.jsxs("select",{value:r,onChange:s=>N(s.target.value),children:[g.length===0?e.jsx("option",{value:"",children:"Nessun cliente disponibile"}):null,g.map(s=>{var a;return e.jsx("option",{value:s.id,children:((a=s.displayName)==null?void 0:a.trim())||s.email||s.id},s.id)})]})]}),e.jsxs("label",{children:["Titolo programma",e.jsx("input",{value:b,onChange:s=>S(s.target.value),placeholder:"Forza 4 settimane"})]}),C.map((s,a)=>e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px solid rgba(18,18,18,0.10)"},children:[e.jsxs("h2",{children:["Esercizio ",a+1]}),e.jsxs("label",{children:["Nome esercizio",e.jsx("input",{value:s.name,onChange:t=>c(a,{name:t.target.value}),placeholder:"Es. Squat bilanciere"})]}),e.jsxs("label",{children:["Numero serie",e.jsx("input",{type:"number",min:1,value:s.sets,onChange:t=>c(a,{sets:Number(t.target.value)})})]}),e.jsxs("label",{children:["Ripetizioni",e.jsx("input",{value:s.reps,onChange:t=>c(a,{reps:t.target.value}),placeholder:"Es. 8-10"})]}),e.jsxs("label",{children:["Peso",e.jsx("input",{value:s.weight,onChange:t=>c(a,{weight:t.target.value}),placeholder:"Es. 40kg o corpo libero"})]}),e.jsxs("label",{children:["URL video o immagine",e.jsx("input",{value:s.mediaUrl,onChange:t=>c(a,{mediaUrl:t.target.value}),placeholder:"https://..."})]}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>L(a),children:"Rimuovi esercizio"})]},`exercise-${a}`)),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:I,children:"Aggiungi esercizio"}),e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px dashed rgba(18,18,18,0.16)"},children:[e.jsx("h2",{children:"Informazioni del cliente"}),e.jsxs("p",{className:"hint",children:["Obiettivo: ",((E=i==null?void 0:i.goal)==null?void 0:E.trim())||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Livello: ",(i==null?void 0:i.experienceLevel)||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Allenamenti a settimana: ",(i==null?void 0:i.trainingDaysPerWeek)??"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Note: ",((P=i==null?void 0:i.notes)==null?void 0:P.trim())||"Nessuna nota inserita"]})]}),e.jsx("button",{className:"btn",disabled:!r||!b||x,onClick:()=>void q(),type:"button",children:"Salva scheda tecnica"})]}),o==="admin"?e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Gestione accessi"}),e.jsxs("label",{children:["Codice utente",e.jsx("input",{value:v,onChange:s=>T(s.target.value),placeholder:"Inserisci il codice utente"})]}),e.jsxs("label",{children:["Profilo accesso",e.jsxs("select",{value:y,onChange:s=>D(s.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"trainer",children:"Coach"}),e.jsx("option",{value:"client",children:"Cliente"})]})]}),e.jsx("button",{className:"btn",disabled:!v||x,onClick:()=>void U(()=>B(v,y),"Accesso aggiornato."),type:"button",children:"Aggiorna accesso"})]}):null,e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Panoramica"}),e.jsxs("p",{className:"hint",children:["Clienti registrati: ",g.length]}),e.jsxs("p",{className:"hint",children:["Programmi creati: ",f.length]}),e.jsx("ul",{className:"list",children:f.slice(0,5).map(s=>{var a;return e.jsxs("li",{children:[e.jsx("strong",{children:s.title})," · ",((a=s.exercises)==null?void 0:a.length)??0," esercizi · cliente ",s.clientId]},s.id)})})]}),x?e.jsx("p",{className:"message",children:"Caricamento..."}):null]})}export{V as CoachDashboardPage};
