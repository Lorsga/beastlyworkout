import{u as A,a as b,r as l,c as j,j as e,N as u,i as p,l as g,b as N,d as v,e as y,g as C}from"./index-C9ZdR72w.js";import{t as h}from"./firestore-CSdz_xXz.js";const n="bw_login_intent";function G(){const{user:r,role:i}=A(),d=b(),[c,a]=l.useState(!1),[m,s]=l.useState("");if(l.useEffect(()=>{j()},[]),r&&i)return sessionStorage.removeItem(n),e.jsx(u,{to:i==="client"?"/app/client":"/app/coach",replace:!0});if(r&&!i){const t=sessionStorage.getItem(n),o=p(r.email);return t==="coach"&&o?e.jsx(u,{to:"/missing-role",replace:!0}):e.jsx(u,{to:"/app/client",replace:!0})}async function f(){a(!0),s("");try{if(sessionStorage.setItem(n,"client"),(await g()).redirected){s("Apertura accesso Google...");return}d("/app/client",{replace:!0})}catch(t){s(h(t))}finally{a(!1)}}async function x(){a(!0),s("");try{sessionStorage.setItem(n,"coach");const t=await g();if(t.redirected){s("Apertura accesso Google...");return}if(!t.user){s("Accesso non completato. Riprova.");return}if(!p(t.user.email)){await N(),s("Questo account non Ã¨ abilitato come PT/Admin. Usa accesso utente.");return}await v(),await y();const o=await C(t.user);if(o==="admin"||o==="trainer"){d("/app/coach",{replace:!0});return}s("Accesso PT/Admin non completato. Riprova tra qualche secondo.")}catch(t){s(h(t))}finally{a(!1)}}return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accedi con Google"}),e.jsx("p",{className:"hero-sub",children:"Inizia subito: entra come utente e completa il tuo percorso iniziale."}),e.jsx("button",{className:"btn",disabled:c,onClick:()=>void f(),type:"button",children:c?"Connessione...":"Continua con Google"}),e.jsx("div",{className:"divider"}),e.jsx("h2",{children:"Sei PT/Admin?"}),e.jsx("p",{className:"hint",children:"Usa il tuo account autorizzato per entrare nell'area coach."}),e.jsx("button",{className:"btn btn-ghost",disabled:c,onClick:()=>void x(),type:"button",children:"Continua con Google (PT/Admin)"}),m?e.jsx("p",{className:"message",children:m}):null]})})}export{G as AuthPage};
