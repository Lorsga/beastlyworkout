import{u as G,a as H,b as J,r as a,j as e,N as K,h as Q,i as X,k as Y,m as Z,n as ee,o as se,p as ae}from"./index-D28kEXeZ.js";import{A as te}from"./AppShell-DyNJfjCd.js";import{m as o,t as k}from"./firestore-DB3C5Wwr.js";function le(){const{role:x,user:l}=G(),d=H(),{showError:j,showSuccess:P}=J(),[b,L]=a.useState([]),[h,T]=a.useState([]),[f,E]=a.useState([]),[M,I]=a.useState([]),[u,c]=a.useState(!1),[i,S]=a.useState(""),[m,U]=a.useState(""),[v,F]=a.useState(""),[N,R]=a.useState("weight"),[C,V]=a.useState(0),[y,z]=a.useState("kg"),[g,O]=a.useState(""),[W,$]=a.useState(!0);a.useEffect(()=>{async function s(){if(l)try{const n=(await Q(l.uid)).data();if(!(n!=null&&n.onboardingCompleted)){d("/onboarding",{replace:!0});return}}catch{d("/onboarding",{replace:!0});return}finally{$(!1)}}s()},[l,d]);async function A(){var s;c(!0);try{const[t,n,B,_]=await Promise.all([X("client"),Y("client"),Z(),ee()]),p=o(t.docs);L(p),T(o(n.docs)),E(o(B.docs)),I(o(_.docs)),!i&&((s=p[0])!=null&&s.trainerId)&&S(p[0].trainerId)}catch(t){j(k(t))}finally{c(!1)}}if(a.useEffect(()=>{x==="client"&&A()},[x]),!l)return e.jsx(K,{to:"/auth",replace:!0});if(W)return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Prepariamo la tua area"}),e.jsx("p",{className:"hero-sub",children:"Sto verificando le informazioni del tuo profilo..."})]})});async function D(s,t){c(!0);try{await s(),P(t),await A()}catch(n){j(k(n))}finally{c(!1)}}const w=a.useMemo(()=>[...h].sort((s,t)=>new Date(s.startsAt).getTime()-new Date(t.startsAt).getTime()).find(s=>new Date(s.startsAt).getTime()>Date.now()),[h]),r=b[0],q=Array.isArray(r==null?void 0:r.exercises)?r.exercises:[];return e.jsxs(te,{role:"client",subtitle:"Tieni traccia di allenamenti e progressi in modo semplice.",title:"La tua area",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Riepilogo"}),e.jsxs("p",{className:"hint",children:["Programmi ricevuti: ",b.length]}),e.jsxs("p",{className:"hint",children:["Sessioni prenotate: ",h.length]}),e.jsxs("p",{className:"hint",children:["Allenamenti registrati: ",f.length]}),e.jsxs("p",{className:"hint",children:["Progressi inseriti: ",M.length]}),w?e.jsxs("p",{className:"message success",children:["Prossima sessione: ",new Date(w.startsAt).toLocaleString("it-IT")]}):null]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"La tua scheda tecnica"}),r?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"hint",children:e.jsx("strong",{children:r.title})}),e.jsx("ul",{className:"list",children:q.map((s,t)=>e.jsxs("li",{children:[e.jsx("strong",{children:s.name||`Esercizio ${t+1}`})," · ",s.sets??"-"," serie"," · ",s.reps||"-"," reps"," · ",s.weight||"-",s.mediaUrl?e.jsxs(e.Fragment,{children:[" · ",e.jsx("a",{href:s.mediaUrl,target:"_blank",rel:"noreferrer",children:"Video/Immagine"})]}):null]},`plan-ex-${t}`))})]}):e.jsx("p",{className:"hint",children:"La tua scheda non è ancora disponibile. Il coach la pubblicherà a breve."})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Codice Coach"}),e.jsxs("label",{children:["Codice del tuo coach",e.jsx("input",{value:i,onChange:s=>S(s.target.value),placeholder:"Inserisci il codice coach"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Registra allenamento"}),e.jsxs("label",{children:["Data allenamento",e.jsx("input",{value:m,onChange:s=>U(s.target.value),type:"date"})]}),e.jsxs("label",{children:["Com'è andata?",e.jsx("textarea",{value:v,onChange:s=>F(s.target.value),placeholder:"Scrivi come ti sei sentito durante l'allenamento"})]}),e.jsx("button",{className:"btn",disabled:!i||!m||u,onClick:()=>void D(()=>se({trainerId:i,sessionDate:m,notes:v}),"Allenamento salvato."),type:"button",children:"Salva allenamento"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Aggiorna progressi"}),e.jsxs("label",{children:["Tipo di dato",e.jsx("input",{value:N,onChange:s=>R(s.target.value),placeholder:"Es. peso, massa grassa, frequenza"})]}),e.jsxs("label",{children:["Valore",e.jsx("input",{value:C,onChange:s=>V(Number(s.target.value)),type:"number"})]}),e.jsxs("label",{children:["Unità",e.jsx("input",{value:y,onChange:s=>z(s.target.value),placeholder:"Es. kg, %, bpm"})]}),e.jsxs("label",{children:["Data",e.jsx("input",{value:g,onChange:s=>O(s.target.value),type:"date"})]}),e.jsx("button",{className:"btn",disabled:!i||!g||u,onClick:()=>void D(()=>ae({trainerId:i,metricType:N,value:C,unit:y,measuredAt:g}),"Progresso salvato."),type:"button",children:"Salva progresso"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Ultimi allenamenti"}),e.jsx("ul",{className:"list",children:f.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.sessionDate})," · ",s.notes||"Nessuna nota"]},s.id))})]}),u?e.jsx("p",{className:"message",children:"Caricamento..."}):null]})}export{le as ClientDashboardPage};
