import{u as y,a as C,r,c as E,j as e,N as A,l as x,b,d as j,g as N,e as v}from"./index-CrAJx4So.js";import{t as p}from"./firestore-CSdz_xXz.js";const T=["lrnz.sga@gmail.com"];function I(t){return t.trim().toLowerCase()}function G(t){const o=T.join(",");return new Set(o.split(",").map(I).filter(Boolean))}const P=G();function h(t){return t?P.has(I(t)):!1}const n="bw_login_intent";function k(){const{user:t,role:o}=y(),c=C(),[m,i]=r.useState(!1),[l,s]=r.useState(""),[g,f]=r.useState(!1);if(r.useEffect(()=>{E()},[]),r.useEffect(()=>{async function a(){if(!(!t||o||sessionStorage.getItem(n)!=="coach"||!h(t.email))){f(!0),s("Sto completando l'accesso PT/Admin...");try{await b(),await j();const u=await N(t);if(u==="admin"||u==="trainer"){sessionStorage.removeItem(n),c("/app/coach",{replace:!0});return}s("Accesso PT/Admin non pronto, riprova tra pochi secondi.")}catch(u){s(p(u))}finally{f(!1)}}}a()},[t,o,c]),t&&o)return sessionStorage.removeItem(n),e.jsx(A,{to:o==="client"?"/app/client":"/app/coach",replace:!0});if(t&&!o)return sessionStorage.getItem(n)==="coach"&&h(t.email)?e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accesso PT/Admin"}),e.jsx("p",{className:"hero-sub",children:g?"Attendi un attimo...":"Sto verificando il tuo profilo."}),l?e.jsx("p",{className:"message",children:l}):null,e.jsx("button",{className:"btn btn-ghost",disabled:g,onClick:()=>void x(),type:"button",children:"Esci e cambia account"})]})}):e.jsx(A,{to:"/app/client",replace:!0});async function S(){i(!0),s("");try{if(sessionStorage.setItem(n,"client"),(await v()).redirected){s("Apertura accesso Google...");return}c("/app/client",{replace:!0})}catch(a){s(p(a))}finally{i(!1)}}async function w(){i(!0),s("");try{sessionStorage.setItem(n,"coach");const a=await v();if(a.redirected){s("Apertura accesso Google...");return}if(!a.user){s("Accesso non completato. Riprova.");return}if(!h(a.user.email)){await x(),s("Questo account non Ã¨ abilitato come PT/Admin. Usa accesso utente.");return}await b(),await j();const d=await N(a.user);if(d==="admin"||d==="trainer"){sessionStorage.removeItem(n),c("/app/coach",{replace:!0});return}s("Accesso PT/Admin non completato. Riprova tra qualche secondo.")}catch(a){s(p(a))}finally{i(!1)}}return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Accedi con Google"}),e.jsx("p",{className:"hero-sub",children:"Inizia subito: entra come utente e completa il tuo percorso iniziale."}),e.jsx("button",{className:"btn",disabled:m,onClick:()=>void S(),type:"button",children:m?"Connessione...":"Continua con Google"}),e.jsx("div",{className:"divider"}),e.jsx("h2",{children:"Sei PT/Admin?"}),e.jsx("p",{className:"hint",children:"Usa il tuo account autorizzato per entrare nell'area coach."}),e.jsx("button",{className:"btn btn-ghost",disabled:m,onClick:()=>void w(),type:"button",children:"Continua con Google (PT/Admin)"}),l?e.jsx("p",{className:"message",children:l}):null]})})}export{k as AuthPage};
