import{u as M,b as W,r as a,j as e,q as B,s as H,i as J,k as K,t as Q,v as V,w as X}from"./index-BG4rOQnM.js";import{A as Y}from"./AppShell-BEEjIjcW.js";import{t as T}from"./firestore-BAizMrXz.js";function ee(){var A,P;const{role:c}=M(),{showError:v,showSuccess:k}=W(),[d,w]=a.useState([]),[b,R]=a.useState([]),[E,U]=a.useState([]),[r,o]=a.useState(!1),[t,h]=a.useState(null),[l,N]=a.useState(""),[u,D]=a.useState(""),[f,z]=a.useState("check-in"),[p,I]=a.useState(""),[m,F]=a.useState(""),[x,L]=a.useState(""),[C,G]=a.useState("client");a.useEffect(()=>{async function s(){if(!l){h(null);return}try{const n=await B(l,"onboarding");h(n.data()??null)}catch{h(null)}}s()},[l]);async function y(){var s;if(c){o(!0);try{const[n,g,q]=await Promise.all([H(),J(c),K(c)]),S=n.docs.map(i=>({id:i.id,...i.data()})).filter(i=>i.role!=="admin"&&i.role!=="trainer");w(S),!l&&((s=S[0])!=null&&s.id)&&N(S[0].id),R(g.docs.map(i=>({id:i.id,...i.data()}))),U(q.docs.map(i=>({id:i.id,...i.data()})))}catch(n){v(T(n))}finally{o(!1)}}}a.useEffect(()=>{y()},[c]);async function j(s,n){o(!0);try{await s(),k(n),await y()}catch(g){v(T(g))}finally{o(!1)}}return e.jsxs(Y,{role:c==="trainer"?"trainer":"admin",subtitle:"Gestisci clienti, programmi e appuntamenti da un unico posto.",title:"Area Coach",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Crea scheda cliente"}),e.jsxs("label",{children:["Clienti registrati",e.jsxs("select",{value:l,onChange:s=>N(s.target.value),children:[d.length===0?e.jsx("option",{value:"",children:"Nessun cliente disponibile"}):null,d.map(s=>{var n;return e.jsx("option",{value:s.id,children:((n=s.displayName)==null?void 0:n.trim())||s.email||s.id},s.id)})]})]}),e.jsxs("label",{children:["Titolo programma",e.jsx("input",{value:u,onChange:s=>D(s.target.value),placeholder:"Forza 4 settimane"})]}),e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px dashed rgba(18,18,18,0.16)"},children:[e.jsx("h2",{children:"Informazioni del cliente"}),e.jsxs("p",{className:"hint",children:["Obiettivo: ",((A=t==null?void 0:t.goal)==null?void 0:A.trim())||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Livello: ",(t==null?void 0:t.experienceLevel)||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Allenamenti a settimana: ",(t==null?void 0:t.trainingDaysPerWeek)??"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Note: ",((P=t==null?void 0:t.notes)==null?void 0:P.trim())||"Nessuna nota inserita"]})]}),e.jsx("button",{className:"btn",disabled:!l||!u||r,onClick:()=>void j(()=>Q({clientId:l,title:u,status:"active"}),"Scheda creata e già disponibile al cliente."),type:"button",children:"Salva programma"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Agenda sessioni (opzionale)"}),e.jsx("p",{className:"hint",children:"Ti aiuta a segnare appuntamenti, check-in e richiami con il cliente."}),e.jsxs("label",{children:["Data e ora inizio",e.jsx("input",{value:p,onChange:s=>I(s.target.value),type:"datetime-local"})]}),e.jsxs("label",{children:["Data e ora fine",e.jsx("input",{value:m,onChange:s=>F(s.target.value),type:"datetime-local"})]}),e.jsxs("label",{children:["Tipo sessione",e.jsx("input",{value:f,onChange:s=>z(s.target.value),placeholder:"Es. allenamento, check-in"})]}),e.jsx("button",{className:"btn",disabled:!l||!p||!m||r,onClick:()=>void j(()=>V({clientId:l,startsAt:p,endsAt:m,type:f}),"Sessione pianificata con successo."),type:"button",children:"Salva sessione"})]}),c==="admin"?e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Gestione accessi"}),e.jsxs("label",{children:["Codice utente",e.jsx("input",{value:x,onChange:s=>L(s.target.value),placeholder:"Inserisci il codice utente"})]}),e.jsxs("label",{children:["Profilo accesso",e.jsxs("select",{value:C,onChange:s=>G(s.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"trainer",children:"Coach"}),e.jsx("option",{value:"client",children:"Cliente"})]})]}),e.jsx("button",{className:"btn",disabled:!x||r,onClick:()=>void j(()=>X(x,C),"Accesso aggiornato."),type:"button",children:"Aggiorna accesso"})]}):null,e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Panoramica"}),e.jsxs("p",{className:"hint",children:["Clienti registrati: ",d.length]}),e.jsxs("p",{className:"hint",children:["Programmi creati: ",b.length]}),e.jsxs("p",{className:"hint",children:["Sessioni in agenda: ",E.length]}),e.jsx("ul",{className:"list",children:b.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.title})," · ",s.status," · cliente ",s.clientId]},s.id))})]}),r?e.jsx("p",{className:"message",children:"Caricamento..."}):null]})}export{ee as CoachDashboardPage};
