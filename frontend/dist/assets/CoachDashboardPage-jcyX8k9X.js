import{u as B,b as H,r as n,j as e,q as J,s as K,i as Q,t as V,v as X}from"./index-CLZ1V8Um.js";import{A as Y}from"./AppShell-B0Z7eu7V.js";import{t as S}from"./firestore-DB3C5Wwr.js";function ae(){var R,k;const{role:u,user:c}=B(),{showError:d,showSuccess:L}=H(),[b,I]=n.useState([]),[y,w]=n.useState([]),[p,g]=n.useState(!1),[l,v]=n.useState(null),[T,N]=n.useState(!1),[r,P]=n.useState(""),[x,U]=n.useState(""),[A,j]=n.useState([{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}]),[f,D]=n.useState(""),[E,M]=n.useState("client");n.useEffect(()=>{async function a(){if(!r){v(null);return}try{const s=await J(r,"onboarding");v(s.data()??null)}catch{v(null)}}a()},[r]);async function C(){var a;if(u){g(!0);try{const o=(await K()).docs.map(i=>({id:i.id,...i.data()})).filter(i=>i.id!==(c==null?void 0:c.uid)).sort((i,h)=>{const _=(i.displayName||i.email||i.id).toLowerCase(),$=(h.displayName||h.email||h.id).toLowerCase();return _.localeCompare($)});I(o),!r&&((a=o[0])!=null&&a.id)&&P(o[0].id);try{const i=await Q(u);w(i.docs.map(h=>({id:h.id,...h.data()})))}catch(i){w([]),d(S(i))}}catch(s){d(S(s))}finally{g(!1)}}}n.useEffect(()=>{C()},[u,c==null?void 0:c.uid]);async function z(a,s){g(!0);try{await a(),L(s),await C()}catch(t){d(S(t))}finally{g(!1)}}function q(){j(a=>[...a,{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}])}function F(a){j(s=>s.length<=1?s:s.filter((t,o)=>o!==a))}function m(a,s){j(t=>t.map((o,i)=>i===a?{...o,...s}:o))}async function G(){const a=A.map(s=>({name:s.name.trim(),sets:Number(s.sets)||0,reps:s.reps.trim(),weight:s.weight.trim(),mediaUrl:s.mediaUrl.trim()})).filter(s=>s.name.length>0);if(a.length===0){d("Aggiungi almeno un esercizio con nome.");return}await z(()=>V({clientId:r,title:x,status:"active",exercises:a}),"Scheda salvata e subito visibile al cliente."),U(""),j([{name:"",sets:3,reps:"10",weight:"",mediaUrl:""}]),N(!1)}function W(){if(!r){d("Seleziona prima un cliente.");return}if(!x.trim()){d("Inserisci un titolo per la scheda.");return}N(!0)}return e.jsxs(Y,{role:u==="trainer"?"trainer":"admin",subtitle:"Gestisci clienti, programmi e appuntamenti da un unico posto.",title:"Area Coach",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Crea scheda cliente"}),e.jsxs("label",{children:["Clienti registrati",e.jsxs("select",{value:r,onChange:a=>P(a.target.value),children:[b.length===0?e.jsx("option",{value:"",children:"Nessun cliente disponibile"}):null,b.map(a=>{var s;return e.jsx("option",{value:a.id,children:((s=a.displayName)==null?void 0:s.trim())||a.email||a.id},a.id)})]})]}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>void C(),children:"Aggiorna lista clienti"}),e.jsxs("label",{children:["Titolo programma",e.jsx("input",{value:x,onChange:a=>U(a.target.value),placeholder:"Forza 4 settimane"})]}),e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px dashed rgba(18,18,18,0.16)"},children:[e.jsx("h2",{children:"Informazioni del cliente"}),e.jsxs("p",{className:"hint",children:["Obiettivo: ",((R=l==null?void 0:l.goal)==null?void 0:R.trim())||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Livello: ",(l==null?void 0:l.experienceLevel)||"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Allenamenti a settimana: ",(l==null?void 0:l.trainingDaysPerWeek)??"Non disponibile"]}),e.jsxs("p",{className:"hint",children:["Note: ",((k=l==null?void 0:l.notes)==null?void 0:k.trim())||"Nessuna nota inserita"]})]}),e.jsx("button",{className:"btn",disabled:!r||!x||p,onClick:W,type:"button",children:"Crea scheda"})]}),T?e.jsx("section",{className:"modal-overlay",role:"dialog","aria-modal":"true",children:e.jsxs("article",{className:"card modal-card",children:[e.jsx("h2",{children:"Compila la scheda"}),e.jsx("p",{className:"hint",children:"Aggiungi esercizi uno alla volta per completare il programma."}),A.map((a,s)=>e.jsxs("article",{className:"card",style:{boxShadow:"none",border:"1px solid rgba(18,18,18,0.10)"},children:[e.jsxs("h2",{children:["Esercizio ",s+1]}),e.jsxs("label",{children:["Nome esercizio",e.jsx("input",{value:a.name,onChange:t=>m(s,{name:t.target.value}),placeholder:"Es. Squat bilanciere"})]}),e.jsxs("label",{children:["Numero serie",e.jsx("input",{type:"number",min:1,value:a.sets,onChange:t=>m(s,{sets:Number(t.target.value)})})]}),e.jsxs("label",{children:["Ripetizioni",e.jsx("input",{value:a.reps,onChange:t=>m(s,{reps:t.target.value}),placeholder:"Es. 8-10"})]}),e.jsxs("label",{children:["Peso",e.jsx("input",{value:a.weight,onChange:t=>m(s,{weight:t.target.value}),placeholder:"Es. 40kg o corpo libero"})]}),e.jsxs("label",{children:["URL video o immagine",e.jsx("input",{value:a.mediaUrl,onChange:t=>m(s,{mediaUrl:t.target.value}),placeholder:"https://..."})]}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>F(s),children:"Rimuovi esercizio"})]},`exercise-${s}`)),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:q,children:"Aggiungi esercizio"}),e.jsx("button",{className:"btn",type:"button",disabled:p,onClick:()=>void G(),children:"Salva scheda tecnica"}),e.jsx("button",{className:"btn btn-ghost",type:"button",onClick:()=>N(!1),children:"Chiudi"})]})}):null,u==="admin"?e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Gestione accessi"}),e.jsxs("label",{children:["Codice utente",e.jsx("input",{value:f,onChange:a=>D(a.target.value),placeholder:"Inserisci il codice utente"})]}),e.jsxs("label",{children:["Profilo accesso",e.jsxs("select",{value:E,onChange:a=>M(a.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"trainer",children:"Coach"}),e.jsx("option",{value:"client",children:"Cliente"})]})]}),e.jsx("button",{className:"btn",disabled:!f||p,onClick:()=>void z(()=>X(f,E),"Accesso aggiornato."),type:"button",children:"Aggiorna accesso"})]}):null,e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Panoramica"}),e.jsxs("p",{className:"hint",children:["Clienti registrati: ",b.length]}),e.jsxs("p",{className:"hint",children:["Programmi creati: ",y.length]}),e.jsx("ul",{className:"list",children:y.slice(0,5).map(a=>{var s;return e.jsxs("li",{children:[e.jsx("strong",{children:a.title})," · ",((s=a.exercises)==null?void 0:s.length)??0," esercizi · cliente ",a.clientId]},a.id)})})]}),p?e.jsx("p",{className:"message",children:"Caricamento..."}):null]})}export{ae as CoachDashboardPage};
