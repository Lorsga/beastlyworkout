import{u as B,r as t,j as e,e as G,f as H,h as J,i as K,k as O,m as Q}from"./index-CubVF6E_.js";import{A as X}from"./AppShell-CqYBKeB0.js";import{m as r,t as A}from"./firestore-CSdz_xXz.js";function $(){const{role:g}=B(),[w,T]=t.useState([]),[o,k]=t.useState([]),[p,L]=t.useState([]),[P,I]=t.useState([]),[x,l]=t.useState(""),[j,S]=t.useState(""),[c,i]=t.useState(!1),[n,v]=t.useState(""),[u,U]=t.useState(""),[N,E]=t.useState(""),[b,F]=t.useState("weight"),[f,R]=t.useState(0),[D,W]=t.useState("kg"),[d,z]=t.useState("");async function C(){var s;i(!0),l("");try{const[a,h,V,q]=await Promise.all([G("client"),H("client"),J(),K()]),m=r(a.docs);T(m),k(r(h.docs)),L(r(V.docs)),I(r(q.docs)),!n&&((s=m[0])!=null&&s.trainerId)&&v(m[0].trainerId)}catch(a){l(A(a))}finally{i(!1)}}t.useEffect(()=>{g==="client"&&C()},[g]);async function M(s,a){S(""),l(""),i(!0);try{await s(),S(a),await C()}catch(h){l(A(h))}finally{i(!1)}}const y=t.useMemo(()=>[...o].sort((s,a)=>new Date(s.startsAt).getTime()-new Date(a.startsAt).getTime()).find(s=>new Date(s.startsAt).getTime()>Date.now()),[o]);return e.jsxs(X,{role:"client",subtitle:"Allenamenti, log e metriche, ottimizzati per uso da telefono.",title:"Dashboard Cliente",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Riepilogo rapido"}),e.jsxs("p",{className:"hint",children:["Piani assegnati: ",w.length]}),e.jsxs("p",{className:"hint",children:["Sessioni pianificate: ",o.length]}),e.jsxs("p",{className:"hint",children:["Log inviati: ",p.length]}),e.jsxs("p",{className:"hint",children:["Metriche: ",P.length]}),y?e.jsxs("p",{className:"message success",children:["Prossima sessione: ",new Date(y.startsAt).toLocaleString("it-IT")]}):null]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Trainer UID"}),e.jsxs("label",{children:["Trainer assegnato",e.jsx("input",{value:n,onChange:s=>v(s.target.value),placeholder:"uid coach"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Nuovo Workout Log"}),e.jsxs("label",{children:["Data sessione",e.jsx("input",{value:u,onChange:s=>U(s.target.value),type:"date"})]}),e.jsxs("label",{children:["Note",e.jsx("textarea",{value:N,onChange:s=>E(s.target.value),placeholder:"come è andato l'allenamento"})]}),e.jsx("button",{className:"btn",disabled:!n||!u||c,onClick:()=>void M(()=>O({trainerId:n,sessionDate:u,notes:N}),"Workout log salvato."),type:"button",children:"Salva log"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Nuova metrica"}),e.jsxs("label",{children:["Tipo metrica",e.jsx("input",{value:b,onChange:s=>F(s.target.value),placeholder:"weight, bf, vo2..."})]}),e.jsxs("label",{children:["Valore",e.jsx("input",{value:f,onChange:s=>R(Number(s.target.value)),type:"number"})]}),e.jsxs("label",{children:["Unità",e.jsx("input",{value:D,onChange:s=>W(s.target.value),placeholder:"kg, %, bpm..."})]}),e.jsxs("label",{children:["Data misurazione",e.jsx("input",{value:d,onChange:s=>z(s.target.value),type:"date"})]}),e.jsx("button",{className:"btn",disabled:!n||!d||c,onClick:()=>void M(()=>Q({trainerId:n,metricType:b,value:f,unit:D,measuredAt:d}),"Metrica salvata."),type:"button",children:"Salva metrica"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Ultimi log"}),e.jsx("ul",{className:"list",children:p.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.sessionDate})," · ",s.notes||"Nessuna nota"]},s.id))})]}),c?e.jsx("p",{className:"message",children:"Caricamento..."}):null,j?e.jsx("p",{className:"message success",children:j}):null,x?e.jsx("p",{className:"message",children:x}):null]})}export{$ as ClientDashboardPage};
