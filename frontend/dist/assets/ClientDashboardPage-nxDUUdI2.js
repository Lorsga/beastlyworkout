import{u as B,r as t,j as e,f as G,h as H,i as J,k as K,m as O,n as Q}from"./index-C6aJxY-I.js";import{A as X}from"./AppShell-BpZOOKnV.js";import{m as r,t as M}from"./firestore-BAizMrXz.js";function $(){const{role:g}=B(),[w,P]=t.useState([]),[c,T]=t.useState([]),[p,L]=t.useState([]),[k,E]=t.useState([]),[x,l]=t.useState(""),[j,S]=t.useState(""),[o,i]=t.useState(!1),[n,v]=t.useState(""),[u,I]=t.useState(""),[b,R]=t.useState(""),[N,F]=t.useState("weight"),[C,U]=t.useState(0),[f,V]=t.useState("kg"),[d,W]=t.useState("");async function D(){var s;i(!0),l("");try{const[a,h,q,z]=await Promise.all([G("client"),H("client"),J(),K()]),m=r(a.docs);P(m),T(r(h.docs)),L(r(q.docs)),E(r(z.docs)),!n&&((s=m[0])!=null&&s.trainerId)&&v(m[0].trainerId)}catch(a){l(M(a))}finally{i(!1)}}t.useEffect(()=>{g==="client"&&D()},[g]);async function A(s,a){S(""),l(""),i(!0);try{await s(),S(a),await D()}catch(h){l(M(h))}finally{i(!1)}}const y=t.useMemo(()=>[...c].sort((s,a)=>new Date(s.startsAt).getTime()-new Date(a.startsAt).getTime()).find(s=>new Date(s.startsAt).getTime()>Date.now()),[c]);return e.jsxs(X,{role:"client",subtitle:"Tieni traccia di allenamenti e progressi in modo semplice.",title:"La tua area",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Riepilogo"}),e.jsxs("p",{className:"hint",children:["Programmi ricevuti: ",w.length]}),e.jsxs("p",{className:"hint",children:["Sessioni prenotate: ",c.length]}),e.jsxs("p",{className:"hint",children:["Allenamenti registrati: ",p.length]}),e.jsxs("p",{className:"hint",children:["Progressi inseriti: ",k.length]}),y?e.jsxs("p",{className:"message success",children:["Prossima sessione: ",new Date(y.startsAt).toLocaleString("it-IT")]}):null]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Codice Coach"}),e.jsxs("label",{children:["Codice del tuo coach",e.jsx("input",{value:n,onChange:s=>v(s.target.value),placeholder:"Inserisci il codice coach"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Registra allenamento"}),e.jsxs("label",{children:["Data allenamento",e.jsx("input",{value:u,onChange:s=>I(s.target.value),type:"date"})]}),e.jsxs("label",{children:["Com'è andata?",e.jsx("textarea",{value:b,onChange:s=>R(s.target.value),placeholder:"Scrivi come ti sei sentito durante l'allenamento"})]}),e.jsx("button",{className:"btn",disabled:!n||!u||o,onClick:()=>void A(()=>O({trainerId:n,sessionDate:u,notes:b}),"Allenamento salvato."),type:"button",children:"Salva allenamento"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Aggiorna progressi"}),e.jsxs("label",{children:["Tipo di dato",e.jsx("input",{value:N,onChange:s=>F(s.target.value),placeholder:"Es. peso, massa grassa, frequenza"})]}),e.jsxs("label",{children:["Valore",e.jsx("input",{value:C,onChange:s=>U(Number(s.target.value)),type:"number"})]}),e.jsxs("label",{children:["Unità",e.jsx("input",{value:f,onChange:s=>V(s.target.value),placeholder:"Es. kg, %, bpm"})]}),e.jsxs("label",{children:["Data",e.jsx("input",{value:d,onChange:s=>W(s.target.value),type:"date"})]}),e.jsx("button",{className:"btn",disabled:!n||!d||o,onClick:()=>void A(()=>Q({trainerId:n,metricType:N,value:C,unit:f,measuredAt:d}),"Progresso salvato."),type:"button",children:"Salva progresso"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Ultimi allenamenti"}),e.jsx("ul",{className:"list",children:p.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.sessionDate})," · ",s.notes||"Nessuna nota"]},s.id))})]}),o?e.jsx("p",{className:"message",children:"Caricamento..."}):null,j?e.jsx("p",{className:"message success",children:j}):null,x?e.jsx("p",{className:"message",children:x}):null]})}export{$ as ClientDashboardPage};
