import{u as B,a as _,b as G,r as a,j as e,N as H,h as J,i as K,k as Q,m as X,n as Y,o as Z,p as ee}from"./index-B1UY7gjC.js";import{A as se}from"./AppShell-D9sg1TQ4.js";import{m as o,t as A}from"./firestore-BAizMrXz.js";function ie(){const{role:j,user:l}=B(),d=_(),{showError:x,showSuccess:k}=G(),[r,P]=a.useState([]),[h,L]=a.useState([]),[b,T]=a.useState([]),[M,E]=a.useState([]),[u,c]=a.useState(!1),[i,f]=a.useState(""),[m,I]=a.useState(""),[S,U]=a.useState(""),[v,F]=a.useState("weight"),[N,R]=a.useState(0),[C,V]=a.useState("kg"),[g,z]=a.useState(""),[O,W]=a.useState(!0);a.useEffect(()=>{async function s(){if(l)try{const n=(await J(l.uid)).data();if(!(n!=null&&n.onboardingCompleted)){d("/onboarding",{replace:!0});return}}catch{d("/onboarding",{replace:!0});return}finally{W(!1)}}s()},[l,d]);async function y(){var s;c(!0);try{const[t,n,$,q]=await Promise.all([K("client"),Q("client"),X(),Y()]),p=o(t.docs);P(p),L(o(n.docs)),T(o($.docs)),E(o(q.docs)),!i&&((s=p[0])!=null&&s.trainerId)&&f(p[0].trainerId)}catch(t){x(A(t))}finally{c(!1)}}if(a.useEffect(()=>{j==="client"&&y()},[j]),!l)return e.jsx(H,{to:"/auth",replace:!0});if(O)return e.jsx("main",{className:"page page-center",children:e.jsxs("section",{className:"card auth-card",children:[e.jsx("p",{className:"eyebrow",children:"Beastly Workout"}),e.jsx("h1",{children:"Prepariamo la tua area"}),e.jsx("p",{className:"hero-sub",children:"Sto verificando le informazioni del tuo profilo..."})]})});async function D(s,t){c(!0);try{await s(),k(t),await y()}catch(n){x(A(n))}finally{c(!1)}}const w=a.useMemo(()=>[...h].sort((s,t)=>new Date(s.startsAt).getTime()-new Date(t.startsAt).getTime()).find(s=>new Date(s.startsAt).getTime()>Date.now()),[h]);return e.jsxs(se,{role:"client",subtitle:"Tieni traccia di allenamenti e progressi in modo semplice.",title:"La tua area",children:[e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Riepilogo"}),e.jsxs("p",{className:"hint",children:["Programmi ricevuti: ",r.length]}),e.jsxs("p",{className:"hint",children:["Sessioni prenotate: ",h.length]}),e.jsxs("p",{className:"hint",children:["Allenamenti registrati: ",b.length]}),e.jsxs("p",{className:"hint",children:["Progressi inseriti: ",M.length]}),w?e.jsxs("p",{className:"message success",children:["Prossima sessione: ",new Date(w.startsAt).toLocaleString("it-IT")]}):null]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"La tua scheda tecnica"}),r[0]?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"hint",children:e.jsx("strong",{children:r[0].title})}),e.jsx("ul",{className:"list",children:(r[0].exercises??[]).map((s,t)=>e.jsxs("li",{children:[e.jsx("strong",{children:s.name||`Esercizio ${t+1}`})," · ",s.sets??"-"," serie"," · ",s.reps||"-"," reps"," · ",s.weight||"-",s.mediaUrl?e.jsxs(e.Fragment,{children:[" · ",e.jsx("a",{href:s.mediaUrl,target:"_blank",rel:"noreferrer",children:"Video/Immagine"})]}):null]},`plan-ex-${t}`))})]}):e.jsx("p",{className:"hint",children:"La tua scheda non è ancora disponibile. Il coach la pubblicherà a breve."})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Codice Coach"}),e.jsxs("label",{children:["Codice del tuo coach",e.jsx("input",{value:i,onChange:s=>f(s.target.value),placeholder:"Inserisci il codice coach"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Registra allenamento"}),e.jsxs("label",{children:["Data allenamento",e.jsx("input",{value:m,onChange:s=>I(s.target.value),type:"date"})]}),e.jsxs("label",{children:["Com'è andata?",e.jsx("textarea",{value:S,onChange:s=>U(s.target.value),placeholder:"Scrivi come ti sei sentito durante l'allenamento"})]}),e.jsx("button",{className:"btn",disabled:!i||!m||u,onClick:()=>void D(()=>Z({trainerId:i,sessionDate:m,notes:S}),"Allenamento salvato."),type:"button",children:"Salva allenamento"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Aggiorna progressi"}),e.jsxs("label",{children:["Tipo di dato",e.jsx("input",{value:v,onChange:s=>F(s.target.value),placeholder:"Es. peso, massa grassa, frequenza"})]}),e.jsxs("label",{children:["Valore",e.jsx("input",{value:N,onChange:s=>R(Number(s.target.value)),type:"number"})]}),e.jsxs("label",{children:["Unità",e.jsx("input",{value:C,onChange:s=>V(s.target.value),placeholder:"Es. kg, %, bpm"})]}),e.jsxs("label",{children:["Data",e.jsx("input",{value:g,onChange:s=>z(s.target.value),type:"date"})]}),e.jsx("button",{className:"btn",disabled:!i||!g||u,onClick:()=>void D(()=>ee({trainerId:i,metricType:v,value:N,unit:C,measuredAt:g}),"Progresso salvato."),type:"button",children:"Salva progresso"})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Ultimi allenamenti"}),e.jsx("ul",{className:"list",children:b.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("strong",{children:s.sessionDate})," · ",s.notes||"Nessuna nota"]},s.id))})]}),u?e.jsx("p",{className:"message",children:"Caricamento..."}):null]})}export{ie as ClientDashboardPage};
